import requests
import sseclient
import json

MCP_URL = "https://your.mcp.server.url"  # Replace with real MCP server
MCP_PAYLOAD = {
    "method": "tools/call",
    "params": {
        "name": "get-vendors",
        "arguments": {}
    }
}

def fetch_mcp_stream():
    print("‚è≥ Connecting to MCP server (event-stream)...")

    headers = {
        "Content-Type": "application/json",
        "Accept": "text/event-stream"
    }

    try:
        response = requests.post(
            MCP_URL,
            json=MCP_PAYLOAD,
            headers=headers,
            stream=True,
            timeout=180
        )

        client = sseclient.SSEClient(response)

        all_data = []

        print("üîÑ Listening to MCP event stream...")

        for event in client.events():
            print(f"üì© Event received: {event.data}")

            try:
                # Try to parse as JSON
                parsed = json.loads(event.data)
                all_data.append(parsed)
            except json.JSONDecodeError:
                # Save raw if not JSON
                all_data.append({"raw": event.data})

        return all_data

    except Exception as e:
        print(f"[ERROR] Failed to read SSE from MCP: {e}")
        return None

# === RUN ===
if __name__ == "__main__":
    data = fetch_mcp_stream()
    if data:
        print("\n‚úÖ Final Parsed Event Stream Data:\n")
        print(json.dumps(data, indent=2))
    else:
        print("\n‚ùå No usable data received from stream.")
